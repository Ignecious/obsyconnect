<div class="admin-settings">
  <!-- Header -->
  <header class="settings-header">
    <div class="header-content">
      <div class="header-left">
        <a routerLink="/" class="logo">üîµ ObsyConnect</a>
        <h1>Admin Settings</h1>
      </div>
      <div class="header-right">
        <span class="user-badge">üë§ Admin</span>
      </div>
    </div>
  </header>

  <!-- Tabs Navigation -->
  <nav class="tabs-nav">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'ai-agent'"
      (click)="setActiveTab('ai-agent')">
      ü§ñ AI Agent
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'channels'"
      (click)="setActiveTab('channels')">
      üì° Channels
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'users'"
      (click)="setActiveTab('users')">
      üë• Users
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'queues'"
      (click)="setActiveTab('queues')">
      üìä Queues
    </button>
  </nav>

  <!-- Tab Content -->
  <div class="tab-content">
    
    <!-- Tab 1: AI Agent -->
    <div class="tab-panel" *ngIf="activeTab === 'ai-agent'">
      <h2 class="tab-title">AI Agent Configuration</h2>
      
      <!-- Agent Basic Settings -->
      <div class="settings-card">
        <h3>Basic Settings</h3>
        <div class="form-group">
          <label>Agent Name</label>
          <input type="text" [(ngModel)]="agentName" class="form-input" />
        </div>
        <div class="form-group">
          <label>Greeting Message</label>
          <textarea [(ngModel)]="agentGreeting" class="form-textarea" rows="3"></textarea>
        </div>
      </div>

      <!-- Knowledge Base -->
      <div class="settings-card">
        <div class="card-header-with-action">
          <h3>Knowledge Base ({{ knowledgeArticles.length }} Articles)</h3>
        </div>
        
        <!-- File Upload Area -->
        <div 
          class="file-upload-area" 
          [class.dragging]="isDragging"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)">
          <div class="upload-icon">üì§</div>
          <div class="upload-text">
            <strong>Drag & drop files here</strong>
            <span>or</span>
            <label class="file-input-label">
              <input 
                type="file" 
                multiple 
                accept=".pdf,.docx,.txt,.doc"
                (change)="onFileSelect($event)"
                style="display: none" />
              <span class="btn-upload">Browse Files</span>
            </label>
          </div>
          <div class="upload-hint">Supported formats: PDF, DOCX, TXT (Max 10MB each)</div>
        </div>
        
        <div class="knowledge-grid">
          <div class="knowledge-item" *ngFor="let article of knowledgeArticles">
            <span class="article-icon">{{ getFileIcon(article.fileType) }}</span>
            <div class="article-info">
              <div class="article-title">{{ article.title }}</div>
              <div class="article-meta">
                <span class="article-category">{{ article.category }}</span>
                <span class="article-separator">‚Ä¢</span>
                <span class="article-size">{{ article.size }}</span>
                <span class="article-separator">‚Ä¢</span>
                <span class="article-date">{{ article.uploadDate }}</span>
              </div>
              <div class="upload-progress" *ngIf="article.uploading">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="article.uploadProgress"></div>
                </div>
                <span class="progress-text">{{ article.uploadProgress }}%</span>
              </div>
            </div>
            <button 
              class="btn-delete" 
              (click)="deleteArticle(article.id)"
              [disabled]="article.uploading"
              title="Delete article">
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>

      <!-- FAQs -->
      <div class="settings-card">
        <div class="card-header-with-action">
          <h3>Frequently Asked Questions ({{ faqs.length }} FAQs)</h3>
          <button class="btn-primary btn-sm" (click)="openFaqModal()">‚ûï Add FAQ</button>
        </div>
        <div class="faq-list">
          <div class="faq-item" *ngFor="let faq of faqs">
            <div class="faq-content">
              <div class="faq-question">Q: {{ faq.question }}</div>
              <div class="faq-answer">A: {{ faq.answer }}</div>
            </div>
            <div class="faq-actions">
              <button class="btn-icon" (click)="editFaq(faq)" title="Edit FAQ">‚úèÔ∏è</button>
              <button class="btn-icon" (click)="deleteFaq(faq.id)" title="Delete FAQ">üóëÔ∏è</button>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Model Settings -->
      <div class="settings-card">
        <h3>AI Model Settings</h3>
        <div class="form-group">
          <label>Model Provider</label>
          <select [(ngModel)]="aiModel" class="form-select">
            <option value="claude-3.5">AWS Bedrock - Claude 3.5 Sonnet</option>
            <option value="claude-3">AWS Bedrock - Claude 3 Opus</option>
            <option value="claude-instant">AWS Bedrock - Claude Instant</option>
          </select>
        </div>
        <div class="form-group">
          <label>Temperature: {{ temperature }}</label>
          <input 
            type="range" 
            [(ngModel)]="temperature" 
            min="0" 
            max="1" 
            step="0.1" 
            class="form-range" />
          <div class="range-labels">
            <span>Precise (0)</span>
            <span>Balanced (0.5)</span>
            <span>Creative (1)</span>
          </div>
        </div>
        <div class="form-group">
          <label>Max Tokens</label>
          <input 
            type="number" 
            [(ngModel)]="maxTokens" 
            class="form-input" 
            min="256" 
            max="4096" 
            step="256" />
          <div class="input-hint">Maximum response length (256-4096 tokens)</div>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="autoEscalation" />
            <span>Enable Auto-Escalation to Human Agents</span>
          </label>
        </div>
        <div class="form-group" *ngIf="autoEscalation">
          <label>Escalation Keywords</label>
          <input 
            type="text" 
            [(ngModel)]="escalationKeywords" 
            class="form-input" 
            placeholder="e.g., refund, complaint, urgent" />
          <div class="input-hint">Comma-separated keywords that trigger human handoff</div>
        </div>
      </div>
      
      <!-- Test AI Agent -->
      <div class="settings-card">
        <h3>Test AI Agent</h3>
        <button class="btn-primary" (click)="testAI()">
          {{ showTestPanel ? '‚ùå Close Test Panel' : 'üß™ Open Test Panel' }}
        </button>
        
        <div class="test-panel" *ngIf="showTestPanel">
          <div class="test-chat">
            <div class="test-input-group">
              <input 
                type="text" 
                [(ngModel)]="testMessage" 
                (keyup.enter)="sendTestMessage()"
                class="test-input" 
                placeholder="Type a test message..." />
              <button class="btn-send" (click)="sendTestMessage()">Send</button>
            </div>
            
            <div class="test-response" *ngIf="testResponse">
              <div class="response-label">AI Response:</div>
              <div class="response-text">{{ testResponse }}</div>
              <div class="response-source" *ngIf="referencedSource">
                <span class="source-icon">üìö</span>
                <span>{{ referencedSource }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab 2: Channels -->
    <div class="tab-panel" *ngIf="activeTab === 'channels'">
      <h2 class="tab-title">Communication Channels</h2>
      
      <div class="channels-grid">
        <!-- WhatsApp Business -->
        <div class="channel-card connected">
          <div class="channel-header">
            <span class="channel-icon">üì±</span>
            <h3>WhatsApp Business</h3>
            <span class="status-badge connected">Connected</span>
          </div>
          <div class="channel-body">
            <div class="channel-detail">
              <label>Phone Number:</label>
              <span>{{ whatsappNumber }}</span>
            </div>
            <div class="channel-detail">
              <label>API Status:</label>
              <span class="status-text success">Active</span>
            </div>
            <button class="btn-secondary">View Credentials</button>
          </div>
        </div>

        <!-- Webchat Widget -->
        <div class="channel-card configured">
          <div class="channel-header">
            <span class="channel-icon">üí¨</span>
            <h3>Webchat Widget</h3>
            <span class="status-badge configured">Configured</span>
          </div>
          <div class="channel-body">
            <div class="form-group">
              <label>Primary Color</label>
              <div class="color-picker-wrapper">
                <input type="color" [(ngModel)]="webchatColor" class="color-input" />
                <span class="color-value">{{ webchatColor }}</span>
              </div>
            </div>
            <div class="form-group">
              <label>Embed Code</label>
              <textarea readonly [value]="embedCode" class="code-textarea" rows="2"></textarea>
              <button class="btn-secondary" (click)="copyEmbedCode()">üìã Copy Code</button>
            </div>
          </div>
        </div>

        <!-- Email -->
        <div class="channel-card not-configured">
          <div class="channel-header">
            <span class="channel-icon">üìß</span>
            <h3>Email</h3>
            <span class="status-badge not-configured">Not Configured</span>
          </div>
          <div class="channel-body">
            <p>Connect your email support channel to handle customer inquiries via email.</p>
            <button class="btn-primary">Configure Email</button>
          </div>
        </div>

        <!-- SMS -->
        <div class="channel-card coming-soon">
          <div class="channel-header">
            <span class="channel-icon">üíå</span>
            <h3>SMS</h3>
            <span class="status-badge coming-soon">Coming Soon</span>
          </div>
          <div class="channel-body">
            <p>SMS support channel will be available in the next release.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab 3: Users -->
    <div class="tab-panel" *ngIf="activeTab === 'users'">
      <h2 class="tab-title">Team & Subscription</h2>
      
      <!-- Subscription Card -->
      <div class="subscription-card">
        <div class="subscription-header">
          <h3>üíé Current Subscription</h3>
          <div class="subscription-price">
            <span class="price">R{{ monthlyPrice }}</span>
            <span class="period">/month</span>
          </div>
        </div>
        <div class="subscription-body">
          <div class="seats-info">
            <div class="seats-visual">
              <div class="seats-used" [style.width.%]="(seatsUsed / seatsTotal) * 100"></div>
            </div>
            <div class="seats-text">
              <span class="seats-count">{{ seatsUsed }} / {{ seatsTotal }} seats used</span>
              <span class="seats-available">{{ seatsTotal - seatsUsed }} seats available</span>
            </div>
          </div>
          <button class="btn-secondary">Upgrade Plan</button>
        </div>
      </div>

      <!-- Team Members -->
      <div class="settings-card">
        <h3>Team Members ({{ teamMembers.length }})</h3>
        <div class="team-list">
          <div class="team-member" *ngFor="let member of teamMembers">
            <div class="member-avatar">{{ member.avatar }}</div>
            <div class="member-info">
              <div class="member-name">{{ member.name }}</div>
              <div class="member-email">{{ member.email }}</div>
            </div>
            <div class="member-role">{{ member.role }}</div>
            <div class="member-status" [class.active]="member.status === 'Active'">
              {{ member.status }}
            </div>
          </div>
        </div>
      </div>

      <!-- Add User Form -->
      <div class="settings-card">
        <h3>Add New User</h3>
        <div class="add-user-form">
          <div class="form-row">
            <div class="form-group">
              <label>Name</label>
              <input type="text" [(ngModel)]="newUser.name" class="form-input" placeholder="Enter name" />
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="newUser.email" class="form-input" placeholder="Enter email" />
            </div>
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="newUser.role" class="form-select">
                <option value="Agent">Agent</option>
                <option value="Team Lead">Team Lead</option>
                <option value="Administrator">Administrator</option>
              </select>
            </div>
          </div>
          <button class="btn-primary" (click)="addUser()">‚ûï Add User</button>
        </div>
        <div class="pricing-note">
          üí° Each additional seat costs R59/month
        </div>
      </div>
    </div>

    <!-- Tab 4: Queues -->
    <div class="tab-panel" *ngIf="activeTab === 'queues'">
      <h2 class="tab-title">Queue Management</h2>
      
      <!-- Queue Overview -->
      <div class="settings-card">
        <h3>Active Queues (5)</h3>
        <div class="queues-grid">
          <div class="queue-card" *ngFor="let queue of queues" [style.border-left-color]="queue.color">
            <div class="queue-name">{{ queue.name }}</div>
            <div class="queue-count">{{ queue.count }}</div>
            <div class="queue-label">cases</div>
          </div>
        </div>
      </div>

      <!-- Routing Rules -->
      <div class="settings-card">
        <h3>Routing Rules (4)</h3>
        <div class="rules-list">
          <div class="rule-item" *ngFor="let rule of routingRules; let i = index">
            <div class="rule-number">{{ i + 1 }}</div>
            <div class="rule-info">
              <div class="rule-name">{{ rule.name }}</div>
              <div class="rule-condition">{{ rule.condition }}</div>
            </div>
            <div class="rule-queue">
              <span class="queue-badge">‚Üí {{ rule.queue }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SLA Settings -->
      <div class="settings-card">
        <h3>SLA Settings</h3>
        <div class="sla-grid">
          <div class="sla-item">
            <label>Standard SLA</label>
            <div class="sla-value">{{ slaSettings.standard }}</div>
          </div>
          <div class="sla-item">
            <label>VIP SLA</label>
            <div class="sla-value">{{ slaSettings.vip }}</div>
          </div>
          <div class="sla-item">
            <label>Business Hours</label>
            <div class="sla-value">{{ slaSettings.businessHours }}</div>
          </div>
        </div>
      </div>

      <!-- Queue Metrics -->
      <div class="settings-card">
        <h3>Queue Metrics (Last 24 Hours)</h3>
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-icon">üì•</div>
            <div class="metric-value">62</div>
            <div class="metric-label">Total Cases</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">‚è±Ô∏è</div>
            <div class="metric-value">2.4h</div>
            <div class="metric-label">Avg Response Time</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">‚úÖ</div>
            <div class="metric-value">45</div>
            <div class="metric-label">Resolved</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">‚ö°</div>
            <div class="metric-value">95%</div>
            <div class="metric-label">SLA Compliance</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- FAQ Modal -->
<div class="modal-overlay" *ngIf="showFaqModal" (click)="closeFaqModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ currentFaq.id === 0 ? 'Add New FAQ' : 'Edit FAQ' }}</h3>
      <button class="modal-close" (click)="closeFaqModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Question *</label>
        <input 
          type="text" 
          [(ngModel)]="currentFaq.question" 
          class="form-input" 
          placeholder="Enter the question" />
      </div>
      <div class="form-group">
        <label>Answer *</label>
        <textarea 
          [(ngModel)]="currentFaq.answer" 
          class="form-textarea" 
          rows="5"
          placeholder="Enter the answer"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeFaqModal()">Cancel</button>
      <button class="btn-primary" (click)="saveFaq()">
        {{ currentFaq.id === 0 ? 'Add FAQ' : 'Save Changes' }}
      </button>
    </div>
  </div>
</div>
